<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capybara Quiz Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p-dark: #634832; }
        body {
            font-family: 'Quicksand', sans-serif;
            background: url('https://wallpapers-clan.com/wp-content/uploads/2025/01/cute-capybaras-napping-in-nature-desktop-wallpaper-preview.jpg') no-repeat center center fixed;
            background-size: cover; height: 100vh; margin: 0; display: flex; justify-content: center; align-items: center;
        }
        #quiz-app {
            background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(5px);
            width: 90%; max-width: 650px; padding: 30px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; position: relative;
        }
        .opt-btn {
            background: white; border: 2px solid var(--p-dark); padding: 15px;
            margin: 10px 0; border-radius: 15px; cursor: pointer; font-weight: bold;
            transition: 0.3s; color: var(--p-dark); text-align: left;
        }
        .opt-btn:hover { background: var(--p-dark); color: white; }
        .hidden { display: none; }
        #timer-bar { height: 8px; background: #e74c3c; width: 100%; border-radius: 5px; margin-bottom: 20px; transition: width 1s linear; }
        #feedback { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 100; }
        #feedback img { width: 180px; border-radius: 50%; border: 4px solid white; }
    </style>
</head>
<body>

<audio id="s-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="s-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>

<div id="quiz-app">
    <div id="intro">
        <h1 id="t-title" style="color: var(--p-dark);">ĐANG TẢI...</h1>
        <p id="t-author" style="font-weight: bold;"></p>
        <p id="t-desc"></p>
        <input type="text" id="user-name" placeholder="Nhập tên em..." style="padding:12px; border-radius:10px; border:2px solid var(--p-dark); width:70%; margin-bottom:20px; text-align:center;">
        <br>
        <button onclick="start()" style="background: var(--p-dark); color:white; border:none; padding:15px 40px; border-radius:30px; cursor:pointer; font-weight:bold;">BẮT ĐẦU</button>
    </div>

    <div id="game" class="hidden">
        <div id="timer-bar"></div>
        <h3 id="q-count" style="color: var(--p-dark);"></h3>
        <p id="q-text" style="font-size: 1.2rem; font-weight: bold; min-height: 60px;"></p>
        <div id="options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>
    </div>

    <div id="result" class="hidden">
        <h2 style="color: var(--p-dark);">HOÀN THÀNH!</h2>
        <p id="final-score" style="font-size: 1.5rem; font-weight: bold;"></p>
        <button onclick="location.reload()" style="background: var(--p-dark); color:white; border:none; padding:10px 30px; border-radius:20px; cursor:pointer;">LÀM LẠI</button>
    </div>

    <div id="feedback"><img id="fb-img" src=""></div>
</div>

<script>
    let data, current = 0, score = 0, timer, timeLeft = 20;

    // Đọc file questions.json
    fetch('questions.json')
        .then(res => res.json())
        .then(json => {
            data = json;
            document.getElementById('t-title').innerText = data.quizTitle;
            document.getElementById('t-author').innerText = "GV: " + data.author;
            document.getElementById('t-desc').innerText = data.description;
        });

    function start() {
        if(!document.getElementById('user-name').value) return alert("Nhập tên đã nhé!");
        data.questions = data.questions.sort(() => Math.random() - 0.5);
        document.getElementById('intro').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        showQ();
    }

    function showQ() {
        if(current >= data.questions.length) return end();
        timeLeft = 20;
        let q = data.questions[current];
        document.getElementById('q-count').innerText = `Câu ${current + 1} / ${data.questions.length}`;
        document.getElementById('q-text').innerText = q.q;
        let html = "";
        q.options.forEach((opt, i) => {
            html += `<div class="opt-btn" onclick="check(${i})">${String.fromCharCode(65+i)}. ${opt}</div>`;
        });
        document.getElementById('options').innerHTML = html;
        runTimer();
    }

    function runTimer() {
        clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            document.getElementById('timer-bar').style.width = (timeLeft/20)*100 + "%";
            if(timeLeft <= 0) { clearInterval(timer); check(-1); }
        }, 1000);
    }

    function check(idx) {
        clearInterval(timer);
        let correct = (idx === data.questions[current].a);
        if(correct) { 
            score++; document.getElementById('s-correct').play(); 
            document.getElementById('fb-img').src="https://i.pinimg.com/736x/06/c5/e7/06c5e7c99e6ad30299fed0807f73deb0.jpg";
        } else { 
            document.getElementById('s-wrong').play();
            document.getElementById('fb-img').src="https://static.vecteezy.com/system/resources/previews/048/942/114/non_2x/cute-capybara-crying-cartoon-illustration-vector.jpg";
        }
        document.getElementById('feedback').style.display = 'block';
        setTimeout(() => {
            document.getElementById('feedback').style.display = 'none';
            current++; showQ();
        }, 1200);
    }

    function end() {
        document.getElementById('game').classList.add('hidden');
        document.getElementById('result').classList.remove('hidden');
        document.getElementById('final-score').innerText = `${document.getElementById('user-name').value}: ${score}/${data.questions.length}`;
    }
</script>
</body>
</html>
